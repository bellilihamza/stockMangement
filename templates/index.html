<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Fixed Top Bar -->
    <div class="top-bar">
        <div class="top-bar-content">
            <div class="title-section">
                <h1 class="app-title" onclick="showView('stock')" style="cursor: pointer;">Med Orange</h1>
                <div id="syncStatusBadge" class="sync-badge sync-offline">
                    <span class="sync-icon">üî¥</span>
                    <span class="sync-text">Hors ligne</span>
                </div>
            </div>

            <div class="top-bar-actions">
                <input type="text" id="searchInput" class="search-bar" placeholder="Rechercher un article..."
                    onkeyup="filterTable()">

                <button class="btn btn-sync" onclick="triggerSync()" title="Synchroniser avec Google Sheets">
                    ‚òÅÔ∏è Synchroniser
                </button>
                <button class="btn btn-primary" onclick="openAddModal()">
                    + Ajouter
                </button>
                <button class="btn btn-success" onclick="openSaleModal()">
                    Vendre
                </button>
                <button id="navHistory" class="btn btn-secondary" onclick="showView('history')">
                    Historique
                </button>
                <button id="navStock" class="btn btn-secondary" onclick="showView('stock')" style="display: none;">
                    ‚Üê Stock
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div id="stockView" class="view-container active">
        <div class="main-content">
            <div class="table-wrapper">
                <table id="stockTable">
                    <thead>
                        <tr>
                            <th>Article</th>
                            <th>Stock</th>
                            <th>Prix (TND)</th>
                            <th>Stock Min</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="stockTableBody">
                        <!-- Data will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- History View (2-Column) -->
    <div id="historyView" class="view-container">
        <div class="history-layout">
            <!-- Left Sidebar (Fixed) -->
            <div class="history-sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Filtres Temporels</h3>
                    <div class="btn-group-vertical">
                        <button id="btnToday" class="btn-sidebar"
                            onclick="setHistoryFilter('today')">Aujourd'hui</button>
                        <button id="btnWeek" class="btn-sidebar" onclick="setHistoryFilter('week')">Cette
                            Semaine</button>
                        <button id="btnMonth" class="btn-sidebar" onclick="setHistoryFilter('month')">Ce Mois</button>
                        <button id="btnAll" class="btn-sidebar active" onclick="setHistoryFilter('all')">Tout</button>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">Personnalis√©</h3>
                    <div class="custom-date-grid">
                        <div class="date-field">
                            <label>De:</label>
                            <input type="date" id="historyStart" onchange="applyHistoryFilters()">
                        </div>
                        <div class="date-field">
                            <label>√Ä:</label>
                            <input type="date" id="historyEnd" onchange="applyHistoryFilters()">
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">Recherche</h3>
                    <div class="search-input-wrapper">
                        <input type="text" id="historySearch" placeholder="Nom de l'article..."
                            onkeyup="applyHistoryFilters()">
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">R√©sum√© des Ventes</h3>
                    <div class="summary-card-vertical">
                        <span class="summary-label">Total Revenu</span>
                        <span id="totalHistoryAmount" class="summary-value">0.00 TND</span>
                    </div>
                    <div class="summary-card-vertical">
                        <span class="summary-label">Quantit√© Vendue</span>
                        <span id="totalHistoryQty" class="summary-value">0</span>
                    </div>
                </div>

                <button class="btn btn-danger btn-block" onclick="clearHistoryFilters()" style="margin-top: auto;">
                    Effacer les filtres
                </button>
            </div>

            <!-- Right Content (Scrollable Table) -->
            <div class="history-content">
                <div class="table-wrapper-plain">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>Date & Heure</th>
                                <th>Article</th>
                                <th>Quantit√©</th>
                                <th>Prix Unitaire</th>
                                <th>Total (TND)</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- Data loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ajouter un Article</h2>
                <span class="close" onclick="closeProductModal()">&times;</span>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">

                <div class="form-group">
                    <label for="nom_article">Nom de l'Article</label>
                    <input type="text" id="nom_article" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="stock">Stock</label>
                        <input type="number" id="stock" min="0" required>
                    </div>

                    <div class="form-group">
                        <label for="min_stock">Stock Min</label>
                        <input type="number" id="min_stock" min="0" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prix">Prix (TND)</label>
                    <input type="number" id="prix" min="0" step="0.01" required>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeProductModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sale Modal -->
    <div id="saleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Effectuer une Vente</h2>
                <span class="close" onclick="closeSaleModal()">&times;</span>
            </div>
            <form id="saleForm" onsubmit="processSale(event)">
                <div class="form-group">
                    <label for="saleSearch">Rechercher un Article</label>
                    <input type="text" id="saleSearch" placeholder="Taper pour filtrer..." onkeyup="filterSaleArticles()">
                </div>

                <div class="form-group">
                    <label for="sale_article">Article</label>
                    <select id="sale_article" required>
                        <option value="">-- S√©lectionner un article --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sale_quantite">Quantit√©</label>
                    <input type="number" id="sale_quantite" min="1" required>
                </div>

                <div id="salePreview" class="sale-preview"></div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSaleModal()">Annuler</button>
                    <button type="submit" class="btn btn-success">Valider</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer" class="alert-container"></div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>